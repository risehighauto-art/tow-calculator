<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>RoadTek Tow Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f5f5f5;
    }
    h2 {
      text-align: center;
      color: #222;
    }
    .container {
      max-width: 500px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    input, button {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 16px;
    }
    button {
      background: #000;
      color: white;
      cursor: pointer;
      font-weight: bold;
    }
    button:hover {
      background: #333;
    }
    .result {
      margin-top: 20px;
      padding: 15px;
      background: #e9ffe9;
      border-left: 5px solid #00a000;
      border-radius: 6px;
    }
  </style>
</head>

<body>
  <div class="container">
    <h2>RoadTek Tow Price Calculator</h2>

    <input id="pickup" type="text" placeholder="Enter Pickup Address" />
    <input id="dropoff" type="text" placeholder="Enter Dropoff Address" />

    <button onclick="calculatePrice()">Calculate Price</button>

    <div id="output" class="result" style="display:none;"></div>
  </div>

  <script>
    let pickupAutocomplete, dropoffAutocomplete;

    function initAutocomplete() {
      pickupAutocomplete = new google.maps.places.Autocomplete(
        document.getElementById("pickup")
      );
      dropoffAutocomplete = new google.maps.places.Autocomplete(
        document.getElementById("dropoff")
      );
    }

    function calculatePrice() {
      const pickup = document.getElementById("pickup").value;
      const dropoff = document.getElementById("dropoff").value;

      if (!pickup || !dropoff) {
        alert("Please enter both pickup and dropoff addresses.");
        return;
      }

      const service = new google.maps.DistanceMatrixService();

      service.getDistanceMatrix(
        {
          origins: [pickup],
          destinations: [dropoff],
          travelMode: "DRIVING",
        },
        function (response, status) {
          if (status !== "OK") {
            alert("Error calculating distance.");
            return;
          }

          const distanceText = response.rows[0].elements[0].distance.text;
          const miles = parseFloat(distanceText.replace(" mi", ""));

          // Pricing rules
          const basePrice = 160;
          const includedMiles = 25;
          const extraRate = 2;

          let extraMiles = Math.max(0, miles - includedMiles);
          let extraCost = extraMiles * extraRate;

          // After-hours fee (Central Time)
          const now = new Date();
          const centralTime = new Date(
            now.toLocaleString("en-US", { timeZone: "America/Chicago" })
          );
          const hour = centralTime.getHours();

          let afterHoursFee = 0;
          if (hour < 7 || hour >= 23) {
            afterHoursFee = 50;
          }

          const total = basePrice + extraCost + afterHoursFee;

          document.getElementById("output").style.display = "block";
          document.getElementById("output").innerHTML = `
            <strong>Distance:</strong> ${miles.toFixed(2)} miles<br>
            <strong>Base Price:</strong> $${basePrice}<br>
            <strong>Extra Miles:</strong> ${extraMiles.toFixed(2)} Ã— $2 = $${extraCost.toFixed(2)}<br>
            <strong>After Hours Fee:</strong> $${afterHoursFee}<br><br>
            <strong style="font-size:20px;">Total Price: $${total.toFixed(2)}</strong>
          `;
        }
      );
    }
  </script>

  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBZn5Kj4Um3O4PL1Pcc5XuLY_iLvueqxrc&libraries=places&callback=initAutocomplete" async defer></script>

</body>
</html>
